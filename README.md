# 图床系统项目文档

## 1. 项目概述

图床系统是一个用于图片托管的Web应用程序，提供图片上传、存储、管理和分享功能。
系统分为前端和后端两部分，采用前后端分离的架构设计。用户可以通过Web界面上传图片，系统会将图片存储在服务器或云存储中，并提供访问链接，方便用户在各种场景下引用这些图片。
图片上传到阿里云oss

管理员账号密码都是lst123

### 1.1 项目目标

- 提供简单易用的图片上传和管理功能
- 支持多种上传方式（拖拽上传、多图上传、剪贴板上传）
- 提供稳定快速的图片访问服务
- 支持用户权限管理和图片访问控制
- 提供管理员功能，方便系统管理和维护

## 2. 系统架构

### 2.1 总体架构

系统采用前后端分离的架构，前端使用Vue.js框架开发单页应用，后端使用Spring Boot开发RESTful API。

```
┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│   前端      │      │   后端      │      │  数据库     │
│  Vue.js     │─────>│ Spring Boot │─────>│  MySQL      │
└─────────────┘      └─────────────┘      └─────────────┘
                           │
                           ▼
                     ┌─────────────┐
                     │  存储服务   │
                     │本地/阿里云OSS│
                     └─────────────┘
```

### 2.2 前端架构

前端采用Vue.js框架，使用Vue Router进行路由管理，Element Plus作为UI组件库。

```
┌─────────────────────────────────────────┐
│               前端应用                   │
│                                         │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  │
│  │  路由   │  │  组件   │  │  工具   │  │
│  │ Router  │  │Component│  │Utilities│  │
│  └─────────┘  └─────────┘  └─────────┘  │
│                                         │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  │
│  │  状态   │  │  HTTP   │  │   UI    │  │
│  │  Pinia  │  │ Axios   │  │Element+ │  │
│  └─────────┘  └─────────┘  └─────────┘  │
└─────────────────────────────────────────┘
```

### 2.3 后端架构

后端采用Spring Boot框架，使用多层架构设计：

```
┌─────────────────────────────────────────┐
│               后端应用                   │
│                                         │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  │
│  │ 控制层  │  │ 服务层  │  │  DAO层  │  │
│  │Controller│  │Service │  │   DAO   │  │
│  └─────────┘  └─────────┘  └─────────┘  │
│                                         │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  │
│  │ 安全    │  │ 工具类  │  │  模型   │  │
│  │Security │  │Utilities│  │ Model   │  │
│  └─────────┘  └─────────┘  └─────────┘  │
└─────────────────────────────────────────┘
```

## 3. 数据库设计

### 3.1 用户表(user)

| 字段名      | 类型         | 说明                           |
|------------|--------------|-------------------------------|
| id         | bigint       | 用户ID，主键，自增             |
| username   | varchar(50)  | 用户名，唯一                   |
| password   | varchar(100) | 密码，BCrypt加密               |
| nickname   | varchar(50)  | 昵称                          |
| email      | varchar(100) | 邮箱                          |
| phone      | varchar(20)  | 手机号                        |
| avatar     | varchar(255) | 头像URL                       |
| role_type  | tinyint      | 角色类型（0普通用户，1管理员）  |
| status     | tinyint      | 账号状态（0正常，1禁用）        |
| create_time| datetime     | 创建时间                       |
| update_time| datetime     | 更新时间                       |

### 3.2 图片表(image)

| 字段名        | 类型         | 说明                           |
|--------------|--------------|-------------------------------|
| id           | bigint       | 图片ID，主键，自增             |
| user_id      | bigint       | 用户ID，外键                   |
| name         | varchar(100) | 图片名称                       |
| original_name| varchar(255) | 原始文件名                     |
| path         | varchar(255) | 存储路径                       |
| url          | varchar(255) | 访问URL                       |
| md5          | varchar(32)  | MD5值                         |
| size         | bigint       | 图片大小（字节）               |
| width        | int          | 图片宽度                       |
| height       | int          | 图片高度                       |
| mime_type    | varchar(50)  | 媒体类型                       |
| access_count | bigint       | 访问次数                       |
| deleted      | tinyint      | 删除标志（0未删除，1已删除）    |
| create_time  | datetime     | 创建时间                       |
| update_time  | datetime     | 更新时间                       |

## 4. 功能模块

### 4.1 用户模块

- 用户注册：支持用户名、密码、邮箱等信息注册
- 用户登录：支持用户名密码登录，返回JWT令牌
- 个人中心：查看和修改个人信息
- 密码修改：修改登录密码

### 4.2 图片上传模块

- 拖拽上传：支持拖拽文件到指定区域上传
- 多图上传：支持一次选择多张图片上传
- 剪贴板上传：支持直接粘贴剪贴板中的图片上传
- 上传限制：限制图片格式（jpg、jpeg、png、gif）和大小（单张最大10MB）

### 4.3 图片管理模块

- 图片列表：查看已上传的图片列表
- 图片详情：查看图片详细信息
- 图片删除：删除已上传的图片
- 图片链接：提供多种格式的图片链接（直接链接、Markdown格式等）

### 4.4 管理员模块

- 用户管理：查看、编辑、禁用用户
- 图片管理：查看、删除所有用户的图片
- 系统统计：查看系统使用情况统计
- 权限测试：测试管理员权限

## 5. 技术栈

### 5.1 前端技术

- **框架**：Vue.js 3.x
- **路由**：Vue Router 4.x
- **状态管理**：Pinia 2.x
- **UI组件**：Element Plus 2.x
- **HTTP客户端**：Axios
- **构建工具**：Vite
- **语言**：TypeScript

### 5.2 后端技术

- **框架**：Spring Boot 3.x
- **安全**：Spring Security
- **ORM**：MyBatis
- **数据库**：MySQL
- **缓存**：无（可扩展）
- **文档**：SpringDoc (OpenAPI 3)
- **认证**：JWT (JSON Web Token)
- **存储**：本地存储 + 阿里云OSS

## 6. 接口设计

### 6.1 用户接口

- `POST /api/user/register` - 用户注册
- `POST /api/login` - 用户登录
- `GET /api/user/info` - 获取用户信息
- `PUT /api/user/info` - 更新用户信息
- `PUT /api/user/password` - 修改密码

### 6.2 图片接口

- `POST /api/image/upload` - 上传图片
- `GET /api/image/list` - 获取图片列表
- `GET /api/image/{id}` - 获取图片详情
- `DELETE /api/image/{id}` - 删除图片
- `GET /api/image/access/{id}` - 访问图片（计数）

### 6.3 管理员接口

- `GET /api/admin/users` - 获取用户列表
- `PUT /api/admin/user/{id}` - 更新用户信息
- `PUT /api/admin/user/{id}/status` - 更新用户状态
- `GET /api/admin/images` - 获取所有图片
- `GET /api/admin/stats` - 获取系统统计

## 7. 安全设计

### 7.1 认证与授权

系统使用JWT（JSON Web Token）进行认证，主要流程如下：

1. 用户登录时，服务端验证用户名和密码
2. 验证成功后，服务端生成JWT令牌并返回给客户端
3. 客户端存储令牌，并在后续请求中通过Authorization头发送令牌
4. 服务端验证令牌的有效性，并根据令牌中的信息确定用户身份和权限

### 7.2 权限控制

系统采用基于角色的访问控制（RBAC）：

- 普通用户：只能访问自己的资源
- 管理员：可以访问所有资源和管理功能

### 7.3 安全措施

- 密码加密：使用BCrypt算法加密存储密码
- CSRF防护：禁用Session，使用JWT令牌认证
- 输入验证：前后端都进行输入验证，防止注入攻击
- 文件上传限制：限制文件类型和大小，防止恶意文件上传

## 8. 部署方案

### 8.1 开发环境

- 前端：Node.js环境，使用Vite开发服务器
- 后端：Java环境，使用Spring Boot内嵌Tomcat
- 数据库：本地MySQL数据库
- 存储：本地文件系统

### 8.2 生产环境

- 前端：Nginx静态文件服务
- 后端：独立的Java应用服务器
- 数据库：独立的MySQL服务器
- 存储：本地文件系统或阿里云OSS

### 8.3 配置说明

系统支持两种存储方式：

1. **本地存储**：图片存储在服务器本地文件系统
   - 配置项：`storage.local.path`（存储路径）
   - 配置项：`storage.local.url-prefix`（访问URL前缀）

2. **阿里云OSS**：图片存储在阿里云对象存储服务
   - 配置项：`aliyun.oss.endpoint`（OSS端点）
   - 配置项：`aliyun.oss.accessKeyId`（访问密钥ID）
   - 配置项：`aliyun.oss.accessKeySecret`（访问密钥密钥）
   - 配置项：`aliyun.oss.bucketName`（存储桶名称）
   - 配置项：`aliyun.oss.domain`（自定义域名）

## 9. 使用指南

### 9.1 系统要求

- **前端**：现代浏览器（Chrome、Firefox、Safari、Edge等）
- **后端**：
  - JDK 17+
  - MySQL 8.0+
  - Maven 3.6+

### 9.2 安装部署

1. **数据库初始化**：
   - 创建数据库：`image_hosting`
   - 执行SQL脚本：`image_hosting.sql`

2. **后端部署**：
   - 修改配置文件：`application.yml`
   - 打包：`mvn clean package`
   - 运行：`java -jar image-hosting-web-1.0.0.jar`

3. **前端部署**：
   - 安装依赖：`npm install`
   - 构建：`npm run build`
   - 部署：将dist目录内容部署到Web服务器

### 9.3 使用流程

1. 用户注册/登录
2. 进入控制台
3. 上传图片（拖拽、选择文件或粘贴）
4. 管理图片（查看、复制链接、删除）
5. 在其他平台使用图片链接

## 10. 项目总结

图床系统是一个完整的全栈应用，提供了图片托管服务的核心功能。系统采用前后端分离架构，使用现代Web技术栈开发，具有良好的用户体验和扩展性。

### 10.1 优势特点

- 多种上传方式，满足不同使用场景
- JWT认证，保障系统安全
- 响应式设计，适配不同设备
- 支持本地存储和云存储，灵活部署

### 10.2 未来展望

- 添加图片处理功能（裁剪、压缩、水印等）
- 支持更多云存储服务（七牛云、腾讯云COS等）
- 添加分享功能和访问权限控制
- 优化图片加载性能，支持CDN加速 
